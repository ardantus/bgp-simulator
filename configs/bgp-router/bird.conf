# BGP Router Configuration (AS65000)
# This router connects to two ISPs

log syslog all;
debug protocols all;

router id 192.168.100.10;

# Device protocol for interface management
protocol device {
    scan time 10;
}

# Direct protocol for directly connected networks
protocol direct {
    ipv4;
    ipv6;
}

# Kernel protocol to sync with Linux kernel routing table
protocol kernel {
    ipv4 {
        export all;
        import all;
    };
    learn;
    persist;
}

protocol kernel {
    ipv6 {
        export all;
        import all;
    };
    learn;
    persist;
}

# Static routes
protocol static {
    ipv4;
    # Our own network to advertise
    route 192.168.0.0/16 via 192.168.100.2;
}

# BGP protocol for ISP1 (AS65001)
protocol bgp isp1 {
    description "BGP to ISP1 (AS65001)";
    local as 65000;
    neighbor 10.1.1.254 as 65001;
    
    ipv4 {
        import filter {
            bgp_local_pref = 90;  # Lower than ISP1
            accept;
        };
        export where source = RTS_STATIC;
        next hop self;
    };
    
    # BGP parameters
    hold time 90;
    keepalive time 30;
    connect retry time 30;
    
    # Enable extended next hop for IPv6
    enable extended messages;
}

# BGP protocol for ISP2 (AS65002)
protocol bgp isp2 {
    description "BGP to ISP2 (AS65002)";
    local as 65000;
    neighbor 10.2.2.254 as 65002;
    
    ipv4 {
        import all;
        export where source = RTS_STATIC;
        next hop self;
    };
    
    # BGP parameters
    hold time 90;
    keepalive time 30;
    connect retry time 30;
    
    enable extended messages;
}
